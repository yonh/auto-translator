var background=function(){"use strict";var H=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Z={exports:{}};(function(A,o){(function(i,l){l(A)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:H,function(i){var l,d;if(!((d=(l=globalThis.chrome)==null?void 0:l.runtime)!=null&&d.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const b="The message port closed before a response was received.",w=p=>{const y={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(y).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class P extends WeakMap{constructor(s,g=void 0){super(g),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}const M=e=>e&&typeof e=="object"&&typeof e.then=="function",j=(e,s)=>(...g)=>{p.runtime.lastError?e.reject(new Error(p.runtime.lastError.message)):s.singleCallbackArg||g.length<=1&&s.singleCallbackArg!==!1?e.resolve(g[0]):e.resolve(g)},v=e=>e==1?"argument":"arguments",$=(e,s)=>function(m,...c){if(c.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${v(s.minArgs)} for ${e}(), got ${c.length}`);if(c.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${v(s.maxArgs)} for ${e}(), got ${c.length}`);return new Promise((a,x)=>{if(s.fallbackToNoCallback)try{m[e](...c,j({resolve:a,reject:x},s))}catch(r){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,r),m[e](...c),s.fallbackToNoCallback=!1,s.noCallback=!0,a()}else s.noCallback?(m[e](...c),a()):m[e](...c,j({resolve:a,reject:x},s))})},E=(e,s,g)=>new Proxy(s,{apply(m,c,a){return g.call(c,e,...a)}});let C=Function.call.bind(Object.prototype.hasOwnProperty);const N=(e,s={},g={})=>{let m=Object.create(null),c={has(x,r){return r in e||r in m},get(x,r,h){if(r in m)return m[r];if(!(r in e))return;let u=e[r];if(typeof u=="function")if(typeof s[r]=="function")u=E(e,e[r],s[r]);else if(C(g,r)){let f=$(r,g[r]);u=E(e,e[r],f)}else u=u.bind(e);else if(typeof u=="object"&&u!==null&&(C(s,r)||C(g,r)))u=N(u,s[r],g[r]);else if(C(g,"*"))u=N(u,s[r],g["*"]);else return Object.defineProperty(m,r,{configurable:!0,enumerable:!0,get(){return e[r]},set(f){e[r]=f}}),u;return m[r]=u,u},set(x,r,h,u){return r in m?m[r]=h:e[r]=h,!0},defineProperty(x,r,h){return Reflect.defineProperty(m,r,h)},deleteProperty(x,r){return Reflect.deleteProperty(m,r)}},a=Object.create(e);return new Proxy(a,c)},R=e=>({addListener(s,g,...m){s.addListener(e.get(g),...m)},hasListener(s,g){return s.hasListener(e.get(g))},removeListener(s,g){s.removeListener(e.get(g))}}),W=new P(e=>typeof e!="function"?e:function(g){const m=N(g,{},{getContent:{minArgs:0,maxArgs:0}});e(m)}),F=new P(e=>typeof e!="function"?e:function(g,m,c){let a=!1,x,r=new Promise(T=>{x=function(k){a=!0,T(k)}}),h;try{h=e(g,m,x)}catch(T){h=Promise.reject(T)}const u=h!==!0&&M(h);if(h!==!0&&!u&&!a)return!1;const f=T=>{T.then(k=>{c(k)},k=>{let z;k&&(k instanceof Error||typeof k.message=="string")?z=k.message:z="An unexpected error occurred",c({__mozWebExtensionPolyfillReject__:!0,message:z})}).catch(k=>{console.error("Failed to send onMessage rejected reply",k)})};return f(u?h:r),!0}),q=({reject:e,resolve:s},g)=>{p.runtime.lastError?p.runtime.lastError.message===b?s():e(new Error(p.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?e(new Error(g.message)):s(g)},_=(e,s,g,...m)=>{if(m.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${v(s.minArgs)} for ${e}(), got ${m.length}`);if(m.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${v(s.maxArgs)} for ${e}(), got ${m.length}`);return new Promise((c,a)=>{const x=q.bind(null,{resolve:c,reject:a});m.push(x),g.sendMessage(...m)})},n={devtools:{network:{onRequestFinished:R(W)}},runtime:{onMessage:R(F),onMessageExternal:R(F),sendMessage:_.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:_.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},t={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return y.privacy={network:{"*":t},services:{"*":t},websites:{"*":t}},N(p,n,y)};i.exports=w(chrome)}else i.exports=globalThis.browser})})(Z);var X=Z.exports;const L=V(X);function J(A){return A==null||typeof A=="function"?{main:A}:A}const S=L,I="trans_cache_",O="trans_cache_index";class Q{constructor(){this.cacheIndex=new Map,this.maxAge=6048e5}async init(o){o&&(this.maxAge=o);const i=await S.storage.local.get(O);this.cacheIndex=new Map(Object.entries(i[O]||{})),await this.cleanExpired()}generateHash(o,i,l,d){return`${i}:${l}:${d}:${this.hashCode(o)}`}hashCode(o){let i=0;for(let l=0;l<o.length;l++){const d=o.charCodeAt(l);i=(i<<5)-i+d,i=i&i}return Math.abs(i)}async get(o,i,l,d){const b=this.generateHash(o,i,l,d),w=`${I}${b}`,y=(await S.storage.local.get(w))[w];return y?Date.now()-y.timestamp>this.maxAge?(await this.delete(b),null):y:null}async set(o,i,l,d,b){const w=this.generateHash(o,i,l,d),p=`${I}${w}`,y={originalText:o,translatedText:b,sourceLang:i,targetLang:l,model:d,timestamp:Date.now(),hash:w};await S.storage.local.set({[p]:y}),this.cacheIndex.set(w,y.timestamp),await this.saveIndex(),await this.cleanOldEntries()}async delete(o){const i=`${I}${o}`;await S.storage.local.remove(i),this.cacheIndex.delete(o),await this.saveIndex()}async clear(){const i=Array.from(this.cacheIndex.keys()).map(l=>`${I}${l}`);await S.storage.local.remove([...i,O]),this.cacheIndex.clear()}async saveIndex(){const o=Object.fromEntries(this.cacheIndex);await S.storage.local.set({[O]:o})}async cleanExpired(){const o=Date.now(),i=[];for(const[l,d]of this.cacheIndex.entries())o-d>this.maxAge&&i.push(l);for(const l of i)await this.delete(l)}async cleanOldEntries(){if(this.cacheIndex.size<=1e4)return;const i=Array.from(this.cacheIndex.entries()).sort((d,b)=>d[1]-b[1]),l=i.slice(0,i.length-1e4);for(const[d]of l)await this.delete(d)}async getStats(){if(this.cacheIndex.size===0)return{size:0,oldestTimestamp:0,newestTimestamp:0};const o=Array.from(this.cacheIndex.values());return{size:this.cacheIndex.size,oldestTimestamp:Math.min(...o),newestTimestamp:Math.max(...o)}}}const Y=new Q;function ge(A){}const K=L,G={enabled:!0,autoDetect:!0,targetLanguage:"zh-CN",openai:{apiKey:"",baseUrl:"https://api.openai.com/v1",models:["gpt-3.5-turbo"],maxConcurrency:5,timeout:3e4},cacheEnabled:!0,cacheMaxAge:7*24*60*60*1e3,blacklist:[],whitelist:[],showTranslationBadge:!0};class ee{constructor(){this.settings=G}async init(){await this.loadSettings(),this.settings.cacheEnabled&&await Y.init(this.settings.cacheMaxAge),console.log("[BackgroundManager] Initialized")}async loadSettings(){const o=await K.storage.local.get("settings");this.settings={...G,...o.settings}}async saveSettings(){await K.storage.local.set({settings:this.settings})}async updateSettings(o){this.settings={...this.settings,...o},await this.saveSettings(),o.openai&&(o.openai,console.log("[BackgroundManager] Settings updated:",o.openai))}getSettings(){return{...this.settings}}isUrlAllowed(o){return this.settings.whitelist.length>0?this.settings.whitelist.some(i=>o.includes(i)):this.settings.blacklist.length>0?!this.settings.blacklist.some(i=>o.includes(i)):!0}}const D=new ee,se=L,re=J(()=>{D.init(),se.runtime.onMessage.addListener((A,o,i)=>{if(console.log("[Background] Received message:",A.type),A.type==="getSettings")i(D.getSettings());else if(A.type==="updateSettings")return D.updateSettings(A.settings).then(()=>{i({success:!0})}).catch(l=>{console.error("[Background] Update settings failed:",l),i({success:!1,error:l.message})}),!0;return!0})});function ae(){}var ne={exports:{}};(function(A,o){(function(i,l){l(A)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:H,function(i){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)i.exports=globalThis.browser;else{const l="The message port closed before a response was received.",d=b=>{const w={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(w).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class p extends WeakMap{constructor(t,e=void 0){super(e),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const y=n=>n&&typeof n=="object"&&typeof n.then=="function",P=(n,t)=>(...e)=>{b.runtime.lastError?n.reject(new Error(b.runtime.lastError.message)):t.singleCallbackArg||e.length<=1&&t.singleCallbackArg!==!1?n.resolve(e[0]):n.resolve(e)},M=n=>n==1?"argument":"arguments",j=(n,t)=>function(s,...g){if(g.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${M(t.minArgs)} for ${n}(), got ${g.length}`);if(g.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${M(t.maxArgs)} for ${n}(), got ${g.length}`);return new Promise((m,c)=>{if(t.fallbackToNoCallback)try{s[n](...g,P({resolve:m,reject:c},t))}catch(a){console.warn(`${n} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,a),s[n](...g),t.fallbackToNoCallback=!1,t.noCallback=!0,m()}else t.noCallback?(s[n](...g),m()):s[n](...g,P({resolve:m,reject:c},t))})},v=(n,t,e)=>new Proxy(t,{apply(s,g,m){return e.call(g,n,...m)}});let $=Function.call.bind(Object.prototype.hasOwnProperty);const E=(n,t={},e={})=>{let s=Object.create(null),g={has(c,a){return a in n||a in s},get(c,a,x){if(a in s)return s[a];if(!(a in n))return;let r=n[a];if(typeof r=="function")if(typeof t[a]=="function")r=v(n,n[a],t[a]);else if($(e,a)){let h=j(a,e[a]);r=v(n,n[a],h)}else r=r.bind(n);else if(typeof r=="object"&&r!==null&&($(t,a)||$(e,a)))r=E(r,t[a],e[a]);else if($(e,"*"))r=E(r,t[a],e["*"]);else return Object.defineProperty(s,a,{configurable:!0,enumerable:!0,get(){return n[a]},set(h){n[a]=h}}),r;return s[a]=r,r},set(c,a,x,r){return a in s?s[a]=x:n[a]=x,!0},defineProperty(c,a,x){return Reflect.defineProperty(s,a,x)},deleteProperty(c,a){return Reflect.deleteProperty(s,a)}},m=Object.create(n);return new Proxy(m,g)},C=n=>({addListener(t,e,...s){t.addListener(n.get(e),...s)},hasListener(t,e){return t.hasListener(n.get(e))},removeListener(t,e){t.removeListener(n.get(e))}}),N=new p(n=>typeof n!="function"?n:function(e){const s=E(e,{},{getContent:{minArgs:0,maxArgs:0}});n(s)}),R=new p(n=>typeof n!="function"?n:function(e,s,g){let m=!1,c,a=new Promise(u=>{c=function(f){m=!0,u(f)}}),x;try{x=n(e,s,c)}catch(u){x=Promise.reject(u)}const r=x!==!0&&y(x);if(x!==!0&&!r&&!m)return!1;const h=u=>{u.then(f=>{g(f)},f=>{let T;f&&(f instanceof Error||typeof f.message=="string")?T=f.message:T="An unexpected error occurred",g({__mozWebExtensionPolyfillReject__:!0,message:T})}).catch(f=>{console.error("Failed to send onMessage rejected reply",f)})};return h(r?x:a),!0}),W=({reject:n,resolve:t},e)=>{b.runtime.lastError?b.runtime.lastError.message===l?t():n(new Error(b.runtime.lastError.message)):e&&e.__mozWebExtensionPolyfillReject__?n(new Error(e.message)):t(e)},F=(n,t,e,...s)=>{if(s.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${M(t.minArgs)} for ${n}(), got ${s.length}`);if(s.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${M(t.maxArgs)} for ${n}(), got ${s.length}`);return new Promise((g,m)=>{const c=W.bind(null,{resolve:g,reject:m});s.push(c),e.sendMessage(...s)})},q={devtools:{network:{onRequestFinished:C(N)}},runtime:{onMessage:C(R),onMessageExternal:C(R),sendMessage:F.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:F.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},_={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return w.privacy={network:{"*":_},services:{"*":_},websites:{"*":_}},E(b,q,w)};i.exports=d(chrome)}})})(ne);function B(A,...o){}const te={debug:(...A)=>B(console.debug,...A),log:(...A)=>B(console.log,...A),warn:(...A)=>B(console.warn,...A),error:(...A)=>B(console.error,...A)};let U;try{U=re.main(),U instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(A){throw te.error("The background crashed on startup!"),A}return U}();
background;
