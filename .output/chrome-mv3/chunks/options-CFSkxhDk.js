import{w as $,d as F,o as J,a as M,c as j,b as t,e as p,v as C,f as k,g as W,F as X,r as q,h as b,t as x,i as G,j as h,_ as Q,k as Y}from"./_plugin-vue_export-helper-DkOLU9r1.js";const w=$,I="trans_cache_",A="trans_cache_index";class Z{constructor(){this.cacheIndex=new Map,this.maxAge=7*24*60*60*1e3}async init(o){o&&(this.maxAge=o);const n=await w.storage.local.get(A);this.cacheIndex=new Map(Object.entries(n[A]||{})),await this.cleanExpired()}generateHash(o,n,s,i){return`${n}:${s}:${i}:${this.hashCode(o)}`}hashCode(o){let n=0;for(let s=0;s<o.length;s++){const i=o.charCodeAt(s);n=(n<<5)-n+i,n=n&n}return Math.abs(n)}async get(o,n,s,i){const c=this.generateHash(o,n,s,i),u=`${I}${c}`,d=(await w.storage.local.get(u))[u];return d?Date.now()-d.timestamp>this.maxAge?(await this.delete(c),null):d:null}async set(o,n,s,i,c){const u=this.generateHash(o,n,s,i),g=`${I}${u}`,d={originalText:o,translatedText:c,sourceLang:n,targetLang:s,model:i,timestamp:Date.now(),hash:u};await w.storage.local.set({[g]:d}),this.cacheIndex.set(u,d.timestamp),await this.saveIndex(),await this.cleanOldEntries()}async delete(o){const n=`${I}${o}`;await w.storage.local.remove(n),this.cacheIndex.delete(o),await this.saveIndex()}async clear(){const n=Array.from(this.cacheIndex.keys()).map(s=>`${I}${s}`);await w.storage.local.remove([...n,A]),this.cacheIndex.clear()}async saveIndex(){const o=Object.fromEntries(this.cacheIndex);await w.storage.local.set({[A]:o})}async cleanExpired(){const o=Date.now(),n=[];for(const[s,i]of this.cacheIndex.entries())o-i>this.maxAge&&n.push(s);for(const s of n)await this.delete(s)}async cleanOldEntries(){if(this.cacheIndex.size<=1e4)return;const n=Array.from(this.cacheIndex.entries()).sort((i,c)=>i[1]-c[1]),s=n.slice(0,n.length-1e4);for(const[i]of s)await this.delete(i)}async getStats(){if(this.cacheIndex.size===0)return{size:0,oldestTimestamp:0,newestTimestamp:0};const o=Array.from(this.cacheIndex.values());return{size:this.cacheIndex.size,oldestTimestamp:Math.min(...o),newestTimestamp:Math.max(...o)}}}const V=new Z,ee={class:"options-container"},te={class:"options-main"},se={class:"settings-section"},ae={class:"control-group"},ne={class:"control-group"},oe=["disabled"],le={class:"control-group"},ie=["disabled"],re=["value"],ce={class:"settings-section"},ue={class:"control-group"},de={class:"control-group"},pe={class:"control-group"},me={class:"control-group"},ge={for:"maxConcurrency"},ve={class:"settings-section"},he={class:"control-group"},fe={class:"control-group"},be={for:"cacheMaxAge"},xe={class:"settings-section"},we={class:"control-group"},ye={class:"control-group"},Ce={class:"settings-section"},ke={class:"control-group"},Ie={key:0,class:"settings-section cache-stats"},Ae={class:"stats-grid"},Ue={class:"stat-item"},Ee={class:"stat-value"},Me={class:"stat-item"},je={class:"stat-value"},De={class:"stat-item"},Te={class:"stat-value"},Se={class:"settings-section"},Ve={class:"config-actions"},$e=F({__name:"App",setup(_){const o=$,n=[{code:"zh-CN",name:"简体中文"},{code:"zh-TW",name:"繁體中文"},{code:"en",name:"English"},{code:"ja",name:"日本語"},{code:"ko",name:"한국어"},{code:"fr",name:"Français"},{code:"de",name:"Deutsch"},{code:"es",name:"Español"},{code:"ru",name:"Русский"},{code:"pt",name:"Português"}],s=h({enabled:!0,autoDetect:!0,targetLanguage:"zh-CN",openai:{apiKey:"",baseUrl:"https://api.openai.com/v1",models:["gpt-3.5-turbo"],maxConcurrency:5,timeout:3e4},cacheEnabled:!0,cacheMaxAge:7*24*60*60*1e3,blacklist:[],whitelist:[],showTranslationBadge:!0}),i=h(""),c=h(""),u=h(""),g=h(7),d=h(null),U=h(null),D=h(null);J(async()=>{await B(),await E()});async function B(){const l=await o.storage.local.get("settings");l.settings&&(s.value={...s.value,...l.settings},i.value=s.value.openai.models.join(`
`),c.value=s.value.whitelist.join(`
`),u.value=s.value.blacklist.join(`
`),g.value=Math.floor(s.value.cacheMaxAge/(24*60*60*1e3)))}async function r(){await o.storage.local.set({settings:s.value})}function L(){const l=i.value.split(`
`).map(e=>e.trim()).filter(e=>e.length>0);l.length>0&&(s.value.openai.models=l,r())}function O(){const l=c.value.split(`
`).map(e=>e.trim()).filter(e=>e.length>0);s.value.whitelist=l,r()}function z(){const l=u.value.split(`
`).map(e=>e.trim()).filter(e=>e.length>0);s.value.blacklist=l,r()}function K(){s.value.cacheMaxAge=g.value*24*60*60*1e3,r()}async function R(){confirm("确定要清除所有翻译缓存吗？")&&(await V.clear(),await E(),alert("缓存已清除"))}async function E(){const l=await V.getStats();d.value=l}function T(l){return l?new Date(l).toLocaleDateString():"-"}async function N(){const l={version:"1.0.0",exportedAt:new Date().toISOString(),settings:s.value},e=JSON.stringify(l,null,2),a=new Blob([e],{type:"application/json"}),y=URL.createObjectURL(a),m=document.createElement("a");m.href=y,m.download=`auto-translator-config-${Date.now()}.json`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(y),alert("配置已导出")}function H(){var l;(l=U.value)==null||l.click()}async function P(l){var y;const e=l.target,a=(y=e.files)==null?void 0:y[0];if(a){try{const m=await a.text(),f=JSON.parse(m);if(!f.settings||!f.version)throw new Error("无效的配置文件格式");const S=f.settings,v={...s.value,...S,openai:{...s.value.openai,...S.openai}};s.value=v,v.openai.models&&(i.value=v.openai.models.join(`
`)),v.whitelist&&(c.value=v.whitelist.join(`
`)),v.blacklist&&(u.value=v.blacklist.join(`
`)),v.cacheMaxAge&&(g.value=Math.floor(v.cacheMaxAge/(24*60*60*1e3))),await r(),alert(`配置已导入成功 (版本 ${f.version})`),D.value=null,await E()}catch(m){const f=m instanceof Error?m.message:"导入失败";D.value=f,alert(`导入配置失败: ${f}`)}e&&(e.value="")}}return(l,e)=>(M(),j("div",ee,[e[36]||(e[36]=t("header",{class:"options-header"},[t("h1",null,"自动翻译设置")],-1)),t("main",te,[t("section",se,[e[15]||(e[15]=t("h2",null,"基本设置",-1)),t("div",ae,[t("label",null,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>s.value.enabled=a),onChange:r},null,544),[[C,s.value.enabled]]),e[12]||(e[12]=k(" 启用自动翻译 ",-1))])]),t("div",ne,[t("label",null,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.autoDetect=a),disabled:!s.value.enabled,onChange:r},null,40,oe),[[C,s.value.autoDetect]]),e[13]||(e[13]=k(" 自动检测页面语言 ",-1))])]),t("div",le,[e[14]||(e[14]=t("label",{for:"targetLanguage"},"目标语言",-1)),p(t("select",{id:"targetLanguage","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.targetLanguage=a),disabled:!s.value.enabled,onChange:r},[(M(),j(X,null,q(n,a=>t("option",{key:a.code,value:a.code},x(a.name),9,re)),64))],40,ie),[[W,s.value.targetLanguage]])])]),t("section",ce,[e[20]||(e[20]=t("h2",null,"OpenAI API 配置",-1)),t("div",ue,[e[16]||(e[16]=t("label",{for:"apiKey"},"API 密钥",-1)),p(t("input",{id:"apiKey",type:"password","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.openai.apiKey=a),placeholder:"sk-...",onBlur:r},null,544),[[b,s.value.openai.apiKey]])]),t("div",de,[e[17]||(e[17]=t("label",{for:"baseUrl"},"API 地址",-1)),p(t("input",{id:"baseUrl",type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.openai.baseUrl=a),placeholder:"https://api.openai.com/v1",onBlur:r},null,544),[[b,s.value.openai.baseUrl]])]),t("div",pe,[e[18]||(e[18]=t("label",{for:"models"},"模型列表 (多行输入)",-1)),p(t("textarea",{id:"models","onUpdate:modelValue":e[5]||(e[5]=a=>i.value=a),placeholder:`gpt-3.5-turbo
gpt-4
gpt-4-turbo`,rows:"3",onBlur:L},null,544),[[b,i.value]]),e[19]||(e[19]=t("small",{class:"help-text"}," 每行一个模型，使用多个模型可以绕过单模型并发限制 ",-1))]),t("div",me,[t("label",ge," 最大并发请求数: "+x(s.value.openai.maxConcurrency),1),p(t("input",{id:"maxConcurrency",type:"range","onUpdate:modelValue":e[6]||(e[6]=a=>s.value.openai.maxConcurrency=a),min:"1",max:"20",step:"1",onInput:r},null,544),[[b,s.value.openai.maxConcurrency,void 0,{number:!0}]])])]),t("section",ve,[e[22]||(e[22]=t("h2",null,"缓存设置",-1)),t("div",he,[t("label",null,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>s.value.cacheEnabled=a),onChange:r},null,544),[[C,s.value.cacheEnabled]]),e[21]||(e[21]=k(" 启用翻译缓存 ",-1))])]),t("div",fe,[t("label",be,"缓存有效期 (天): "+x(g.value),1),p(t("input",{id:"cacheMaxAge",type:"range","onUpdate:modelValue":e[8]||(e[8]=a=>g.value=a),min:"1",max:"30",step:"1",onInput:K},null,544),[[b,g.value,void 0,{number:!0}]])]),t("button",{class:"btn-danger",onClick:R}," 清除缓存 ")]),t("section",xe,[e[27]||(e[27]=t("h2",null,"URL 过滤",-1)),t("div",we,[e[23]||(e[23]=t("label",{for:"whitelist"},"白名单 (每行一个 URL)",-1)),p(t("textarea",{id:"whitelist","onUpdate:modelValue":e[9]||(e[9]=a=>c.value=a),placeholder:`example.com
*.example.org`,rows:"3",onBlur:O},null,544),[[b,c.value]]),e[24]||(e[24]=t("small",{class:"help-text"}," 只翻译白名单中的网站，留空则翻译所有网站 ",-1))]),t("div",ye,[e[25]||(e[25]=t("label",{for:"blacklist"},"黑名单 (每行一个 URL)",-1)),p(t("textarea",{id:"blacklist","onUpdate:modelValue":e[10]||(e[10]=a=>u.value=a),placeholder:`translate.google.com
deepl.com`,rows:"3",onBlur:z},null,544),[[b,u.value]]),e[26]||(e[26]=t("small",{class:"help-text"}," 不翻译黑名单中的网站 ",-1))])]),t("section",Ce,[e[29]||(e[29]=t("h2",null,"显示设置",-1)),t("div",ke,[t("label",null,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=a=>s.value.showTranslationBadge=a),onChange:r},null,544),[[C,s.value.showTranslationBadge]]),e[28]||(e[28]=k(" 显示翻译标记 ",-1))])])]),d.value?(M(),j("section",Ie,[e[33]||(e[33]=t("h2",null,"缓存统计",-1)),t("div",Ae,[t("div",Ue,[t("div",Ee,x(d.value.size),1),e[30]||(e[30]=t("div",{class:"stat-label"},"缓存条目",-1))]),t("div",Me,[t("div",je,x(T(d.value.oldestTimestamp)),1),e[31]||(e[31]=t("div",{class:"stat-label"},"最早缓存",-1))]),t("div",De,[t("div",Te,x(T(d.value.newestTimestamp)),1),e[32]||(e[32]=t("div",{class:"stat-label"},"最新缓存",-1))])])])):G("",!0),t("section",Se,[e[34]||(e[34]=t("h2",null,"配置管理",-1)),t("div",Ve,[t("button",{class:"btn-primary",onClick:N}," 导出配置 "),t("button",{class:"btn-secondary",onClick:H}," 导入配置 "),t("input",{type:"file",ref_key:"fileInput",ref:U,accept:".json",style:{display:"none"},onChange:P},null,544)]),e[35]||(e[35]=t("div",{class:"config-note"}," 导出配置可以备份当前设置，导入配置可以快速恢复或共享配置。 ",-1))])])]))}}),_e=Q($e,[["__scopeId","data-v-96558765"]]);Y(_e).mount("#app");
